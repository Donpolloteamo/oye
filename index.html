<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title> </title>
    <style>
        body, html { background-color: #000; margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; }
        #pantalla { width: 100%; height: 100%; cursor: pointer; }
    </style>
</head>
<body>
    <div id="pantalla" onclick="conectar()"></div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <script>
        const firebaseConfig = { databaseURL: "https://sound-nfc-default-rtdb.firebaseio.com/" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        
        // Creamos el objeto de audio
        const audio = new Audio('mambo.mp3');
        let sistemaListo = false;

        function conectar() {
            if (sistemaListo) return;

            // PRIMER TOQUE: Forzamos la carga y reproducción momentánea
            audio.play().then(() => {
                audio.pause();
                audio.currentTime = 0;
                sistemaListo = true;
                console.log("Sistema armado y listo para sonar");
                // Cambiamos el color un segundo para saber que funcionó el toque
                document.body.style.backgroundColor = "#050505"; 
            }).catch(error => console.log("Error al pedir permiso:", error));

            // Escuchamos a Firebase
            db.ref('comando').on('value', (snapshot) => {
                const data = snapshot.val();
                if (sistemaListo && data && data.accion === 'reproducir') {
                    // Forzamos la reproducción inmediata
                    const playPromise = audio.play();
                    if (playPromise !== undefined) {
                        playPromise.catch(error => {
                            console.log("El navegador bloqueó el audio al recibir la señal:", error);
                        });
                    }
                }
            });
        }
    </script>
</body>
</html>
